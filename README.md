# Enterprise AI Insurance Analyst
## AI 보험 정밀 분석 및 컨설팅 플랫폼

1,000페이지 이상의 초대형 보험 약관을 AI로 정밀 분석하여 DB에 자산화하고, 설계사가 고객 데이터와 비교/분석하여 최적의 컨설팅을 제공하는 플랫폼입니다.

## 주요 기능

### Admin (관리자)
- **약관 등록**: PDF 업로드 → 텍스트 추출 → AI 분석 → DB 저장
- **상품 관리**: 등록된 상품 리스트 조회, JSON 데이터 직접 수정, 상품 삭제
- **이력 조회**: 전체 설계사의 상담 이력을 고객명으로 검색 및 상세 열람

### Agent (설계사)
- **고객 분석**: 고객의 기존 증권 PDF 업로드 → AI 분석
- **비교 추천**: DB에 있는 상품과 고객 데이터를 비교 → 부족 담보 도출 및 시각화
- **이력 저장**: 상담 결과를 DB에 영구 저장

## 기술 스택

- **Language**: Python 3.9+
- **Frontend/Backend**: Streamlit
- **PDF Engine**: PyMuPDF (fitz) - 1,000페이지를 3초 만에 텍스트화
- **AI Model**: Google Gemini 1.5 Flash (100만 토큰 컨텍스트)
- **Database**: Supabase (PostgreSQL + JSONB)
- **Visualization**: Plotly Express

## 설치 및 실행

### 1. 패키지 설치

```bash
pip install -r requirements.txt
```

### 2. 환경 변수 설정

프로젝트 폴더 안에 `.streamlit` 폴더를 만들고 `secrets.toml` 파일을 생성해 아래 내용을 채워 넣으세요:

```toml
[supabase]
url = "여기에_SUPABASE_URL"
key = "여기에_SUPABASE_ANON_KEY"

[google]
api_key = "여기에_GEMINI_API_KEY"
```

또는 `.streamlit/secrets.toml.example` 파일을 참고하여 복사한 후 실제 값으로 채워주세요.

### 3. Supabase 데이터베이스 설정

1. Supabase 프로젝트 생성 후 **SQL Editor**에 `app.py` 파일 상단에 있는 SQL(테이블 생성 쿼리)을 복사해 실행하세요.
2. `Project URL`과 `Anon Key`를 확보하세요.

```sql
-- 1. 보험 상품 테이블
CREATE TABLE insurance_products (
    id bigint generated by default as identity primary key,
    created_at timestamp with time zone default timezone('utc'::text, now()) not null,
    product_name text not null,
    company text,
    analysis_data jsonb,
    user_id uuid
);

-- 2. 상담 이력 테이블
CREATE TABLE consulting_history (
    id bigint generated by default as identity primary key,
    created_at timestamp with time zone default timezone('utc'::text, now()) not null,
    customer_name text,
    agent_name text,
    recommended_product_id bigint references insurance_products(id),
    analysis_result jsonb,
    user_id uuid
);
```

### 4. 애플리케이션 실행

```bash
streamlit run app.py
```

브라우저에서 `http://localhost:8501`로 접속하세요.

## 사용 방법

1. **Admin - 약관 등록**: 보험 약관 PDF를 업로드하고 AI 분석을 통해 상품 정보를 데이터베이스에 저장합니다.
2. **Admin - 상품 관리**: 등록된 상품을 조회, 수정, 삭제할 수 있습니다.
3. **Admin - 이력 조회**: 설계사들의 상담 이력을 검색하고 확인할 수 있습니다.
4. **Agent - 고객 분석**: 고객의 기존 보험 증권 PDF를 업로드하여 현재 보장내역을 분석합니다.
5. **Agent - 비교 추천**: 고객 데이터와 등록된 상품을 비교하여 부족한 담보를 도출하고 시각화합니다.

## 배포 방법

### Streamlit Cloud 배포 (추천)

1. GitHub 저장소를 Public 또는 Private으로 설정
2. https://streamlit.io/cloud 접속 후 GitHub 계정으로 로그인
3. "New app" 클릭하여 저장소 연결
4. 환경 변수(Secrets) 설정:
   - `[supabase]` 섹션: `url`, `key`
   - `[google]` 섹션: `api_key`
5. 배포 완료 후 공유 가능한 URL 생성

자세한 배포 가이드는 [DEPLOYMENT.md](./DEPLOYMENT.md)를 참고하세요.

### 로컬 실행

```bash
# 저장소 클론
git clone https://github.com/chegom/insu_2026.git
cd insu_2026

# 의존성 설치
pip install -r requirements.txt

# 환경 변수 설정
mkdir .streamlit
cp .streamlit/secrets.toml.example .streamlit/secrets.toml
# secrets.toml 파일을 열어 실제 API 키 입력

# 실행
streamlit run app.py
```

## 주의사항

⚠️ **테스트 버전**: 현재는 로그인 기능이 없어 누구나 접근 가능합니다.
- 나중에 로그인 기능을 추가하여 접근을 제한할 예정입니다.
- 민감한 데이터는 사용하지 마세요.

- Gemini API는 무료 티어가 있지만 사용량 제한이 있을 수 있습니다.
- 대용량 PDF 파일(1,000페이지 이상) 처리 시 시간이 걸릴 수 있습니다.
- 현재는 고정 user_id를 사용합니다:
  - 관리자 모드: `admin-temp-id`
  - 설계사 모드: `agent-temp-id`
- JSON 파싱 실패 시 자동으로 재시도하며, 최대 3회까지 시도합니다.
- Supabase 연결 실패 시 상세한 에러 메시지와 확인사항을 표시합니다.

## 라이선스

이 프로젝트는 엔터프라이즈용으로 개발되었습니다.

